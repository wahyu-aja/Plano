<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indomaret Photo Editor - BY WHYUU</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-number {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .input-group input[type="text"]:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .photo-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .photo-input {
            text-align: center;
        }

        .photo-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-input {
            display: none;
        }

        .file-input-button {
            display: block;
            padding: 12px 20px;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 14px;
        }

        .file-input-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 60, 114, 0.4);
        }

        .preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
            background: #f9f9f9;
        }

        .preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .process-all-button {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }

        .process-all-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(40, 167, 69, 0.4);
        }

        .process-all-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results-section {
            margin-top: 40px;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            text-align: center;
        }

        .result-canvas {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .download-button {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e3c72;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .photo-inputs, .preview-container {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>BY WHYUU</h1>
            <p>Indomaret Photo Editor</p>
        </div>

        <!-- Global Store Name Input -->
        <div class="card">
            <div class="card-header">
                <div class="card-number">üè™</div>
                <h3>Nama Toko Global</h3>
            </div>
            <div class="input-group">
                <label for="global-store-name">Nama Toko (untuk semua kartu):</label>
                <input type="text" id="global-store-name" placeholder="Masukkan nama toko (contoh: TACCIPI BONE)" value="TACCIPI BONE">
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    Hasil: <strong>INDOMARET:<span id="store-preview">TACCIPI BONE</span></strong>
                </p>
            </div>
        </div>

        <div id="editor-cards">
            <!-- Cards will be generated by JavaScript -->
        </div>

        <button class="process-all-button" onclick="processAllPhotos()">
            BUAT SEMUA FOTO
        </button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Memproses foto...</p>
        </div>

        <div class="results-section" id="results">
            <!-- Results will be displayed here -->
        </div>
    </div>

    <script>
        // Generate 8 editor cards
        function generateCards() {
            const container = document.getElementById('editor-cards');
            
            for (let i = 1; i <= 8; i++) {
                const cardHTML = `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-number">${i}</div>
                            <h3>Editor Foto ${i}</h3>
                        </div>

                        <div class="photo-inputs">
                            <div class="photo-input">
                                <label>Foto Contoh:</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="contoh-${i}" class="file-input" accept="image/*" onchange="previewImage(this, 'contoh-preview-${i}')">
                                    <label for="contoh-${i}" class="file-input-button">Upload Foto Contoh</label>
                                </div>
                            </div>
                            
                            <div class="photo-input">
                                <label>Foto Realisasi:</label>
                                <div class="file-input-wrapper">
                                    <input type="file" id="realisasi-${i}" class="file-input" accept="image/*" onchange="previewImage(this, 'realisasi-preview-${i}')">
                                    <label for="realisasi-${i}" class="file-input-button">Upload Foto Realisasi</label>
                                </div>
                            </div>
                        </div>

                        <div class="preview-container">
                            <div class="preview" id="contoh-preview-${i}">
                                Preview Foto Contoh
                            </div>
                            <div class="preview" id="realisasi-preview-${i}">
                                Preview Foto Realisasi
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHTML;
            }
        }

        // Preview uploaded image
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        // Process all photos
        async function processAllPhotos() {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const button = document.querySelector('.process-all-button');
            const globalStoreName = document.getElementById('global-store-name').value.trim();
            
            if (!globalStoreName) {
                alert('Mohon isi nama toko terlebih dahulu!');
                return;
            }
            
            // Show loading
            loading.style.display = 'block';
            button.disabled = true;
            results.innerHTML = '';

            // Process each card
            for (let i = 1; i <= 8; i++) {
                const contohFile = document.getElementById(`contoh-${i}`).files[0];
                const realisasiFile = document.getElementById(`realisasi-${i}`).files[0];

                if (contohFile && realisasiFile) {
                    try {
                        const canvas = await createComparisonImage(globalStoreName, contohFile, realisasiFile, i);
                        displayResult(canvas, i, globalStoreName);
                    } catch (error) {
                        console.error(`Error processing card ${i}:`, error);
                    }
                }
            }

            // Hide loading
            loading.style.display = 'none';
            button.disabled = false;
        }

        // Create comparison image using template
        function createComparisonImage(storeName, contohFile, realisasiFile, cardNumber) {
            return new Promise((resolve, reject) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Load template image first
                const templateImg = new Image();
                templateImg.crossOrigin = "anonymous";
                templateImg.onload = function() {
                    // Set canvas size based on template
                    canvas.width = templateImg.width;
                    canvas.height = templateImg.height;
                    
                    // Draw template background
                    ctx.drawImage(templateImg, 0, 0);
                    
                    // Calculate positions based on template proportions
                    const templateWidth = templateImg.width;
                    const templateHeight = templateImg.height;
                    
                    // Store name area (white rectangle at top)
                    const nameAreaX = templateWidth * 0.06; // 6% from left
                    const nameAreaY = templateHeight * 0.08; // 8% from top
                    const nameAreaWidth = templateWidth * 0.88; // 88% of width
                    const nameAreaHeight = templateHeight * 0.13; // 13% of height
                    
                    // Clear and redraw store name area
                    ctx.fillStyle = 'white';
                    ctx.fillRect(nameAreaX, nameAreaY, nameAreaWidth, nameAreaHeight);
                    
                    // Add store name text
                    ctx.fillStyle = 'black';
                    ctx.font = `bold ${Math.floor(templateHeight * 0.06)}px Arial`;
                    ctx.textAlign = 'left';
                    ctx.fillText('INDOMARET:' + storeName, nameAreaX + 20, nameAreaY + nameAreaHeight * 0.7);
                    
                    // Calculate photo areas
                    const photoAreaY = templateHeight * 0.35; // Start below headers
                    const photoAreaHeight = templateHeight * 0.55; // Height for photos
                    const photoAreaWidth = templateWidth * 0.44; // Width for each photo
                    
                    // Left photo area (CONTOH)
                    const contohX = templateWidth * 0.06;
                    const contohY = photoAreaY;
                    
                    // Right photo area (REALISASI)
                    const realisasiX = templateWidth * 0.52;
                    const realisasiY = photoAreaY;
                    
                    // Load and draw user images
                    let userImagesLoaded = 0;
                    
                    function checkUserImagesComplete() {
                        userImagesLoaded++;
                        if (userImagesLoaded === 2) {
                            resolve(canvas);
                        }
                    }
                    
                    // Load contoh image
                    const contohImg = new Image();
                    contohImg.onload = function() {
                        ctx.drawImage(contohImg, contohX, contohY, photoAreaWidth, photoAreaHeight);
                        checkUserImagesComplete();
                    };
                    contohImg.onerror = function() {
                        console.error('Error loading contoh image');
                        checkUserImagesComplete();
                    };
                    contohImg.src = URL.createObjectURL(contohFile);
                    
                    // Load realisasi image
                    const realisasiImg = new Image();
                    realisasiImg.onload = function() {
                        ctx.drawImage(realisasiImg, realisasiX, realisasiY, photoAreaWidth, photoAreaHeight);
                        checkUserImagesComplete();
                    };
                    realisasiImg.onerror = function() {
                        console.error('Error loading realisasi image');
                        checkUserImagesComplete();
                    };
                    realisasiImg.src = URL.createObjectURL(realisasiFile);
                };
                
                templateImg.onerror = function() {
                    console.error('Error loading template image, using fallback');
                    // Fallback to creating template programmatically
                    canvas.width = 800;
                    canvas.height = 600;
                    
                    // Create blue gradient background
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, '#4A90E2');
                    gradient.addColorStop(1, '#7B68EE');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Store name background
                    ctx.fillStyle = 'white';
                    ctx.fillRect(50, 50, canvas.width - 100, 80);
                    
                    // Store name text
                    ctx.fillStyle = 'black';
                    ctx.font = 'bold 36px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText('INDOMARET:' + storeName, 70, 105);
                    
                    // Section backgrounds
                    ctx.fillStyle = 'white';
                    ctx.fillRect(50, 160, 330, 400); // CONTOH
                    ctx.fillRect(420, 160, 330, 400); // REALISASI
                    
                    // Section titles
                    ctx.fillStyle = 'black';
                    ctx.font = 'bold 32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('CONTOH', 215, 200);
                    ctx.fillText('REALISASI', 585, 200);
                    
                    // Load user images for fallback
                    let fallbackImagesLoaded = 0;
                    
                    function checkFallbackComplete() {
                        fallbackImagesLoaded++;
                        if (fallbackImagesLoaded === 2) {
                            resolve(canvas);
                        }
                    }
                    
                    const contohImg = new Image();
                    contohImg.onload = function() {
                        ctx.drawImage(contohImg, 60, 220, 310, 330);
                        checkFallbackComplete();
                    };
                    contohImg.src = URL.createObjectURL(contohFile);
                    
                    const realisasiImg = new Image();
                    realisasiImg.onload = function() {
                        ctx.drawImage(realisasiImg, 430, 220, 310, 330);
                        checkFallbackComplete();
                    };
                    realisasiImg.src = URL.createObjectURL(realisasiFile);
                };
                
                // Try to load template image (adjust path as needed)
                templateImg.src = 'template.jpg'; // atau 'template.png' sesuai format file Anda
            });
        }

        // Display result
        function displayResult(canvas, cardNumber, storeName) {
            const results = document.getElementById('results');
            
            const resultHTML = `
                <div class="result-card">
                    <h3>Hasil Foto ${cardNumber} - ${storeName}</h3>
                    <canvas class="result-canvas" id="result-canvas-${cardNumber}"></canvas>
                    <div>
                        <button class="download-button" onclick="downloadImage(${cardNumber}, '${storeName}')">
                            Download Foto
                        </button>
                    </div>
                </div>
            `;
            
            results.innerHTML += resultHTML;
            
            // Copy canvas to result canvas
            const resultCanvas = document.getElementById(`result-canvas-${cardNumber}`);
            const resultCtx = resultCanvas.getContext('2d');
            resultCanvas.width = canvas.width;
            resultCanvas.height = canvas.height;
            resultCtx.drawImage(canvas, 0, 0);
        }

        // Download image
        function downloadImage(cardNumber, storeName) {
            const canvas = document.getElementById(`result-canvas-${cardNumber}`);
            const link = document.createElement('a');
            link.download = `${storeName}_Perbandingan_${cardNumber}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        // Initialize the page
        generateCards();
        
        // Update store name preview
        document.getElementById('global-store-name').addEventListener('input', function() {
            const preview = document.getElementById('store-preview');
            const value = this.value.trim();
            preview.textContent = value || 'TACCIPI BONE';
        });
    </script>
</body>
</html>
